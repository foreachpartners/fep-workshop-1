## Техническое задание на разработку бекенда сервиса учета трудозатрат

## Ключевые слова

FastAPI >=0.110.0, Python >=3.12, Google Sheets API v4, OAuth 2.0, Next.js >=14, React >=18, React Query >=4, Tailwind CSS >=3, uvicorn >=0.29.0, Ubuntu 24.04 LTS, nginx >=1.24, systemd, OpenAPI 3.0, REST API, VPS, Google Drive API v3, Telegram Bot API (optional), Time & Materials accounting, Google Apps Script (optional), Single Source of Truth (Google Sheets)

### 1. Цель разработки
Разработка бекенд-сервиса для автоматизации учета трудозатрат команды разработки по модели Time & Materials с использованием Google Sheets API.

### 2. Функциональные требования

#### 2.1 Основные функции

- **Управление проектами:**
  - Создание нового проекта.
  - Подключение и отключение специалистов.
  - Изменение ставок и ролей специалистов.

- **Генерация таймшитов:**
  - Создание и копирование Google Sheets-таймшитов по шаблону.
  - Настройка доступов для специалистов (доступ на запись).
  - Автоматическое обновление таймшитов при изменении данных специалистов.

- **Управление периодами оплаты:**
  - Создание и закрытие периодов оплаты с возможностью указания произвольного названия и дат.
  - Автоматическое заполнение поля "Период оплаты" в таймшитах.

- **Формирование отчетов:**
  - Генерация сводного отчета по затратам проекта на основе данных из таймшитов.
  - Автоматическое создание и обновление вкладок в отчете с расчетами итоговых сумм по специалистам и общих затрат.

---

### Технические требования:

#### Стек технологий

- Язык разработки: **Python**
- Веб-фреймворк: **FastAPI**
- Google Sheets API
- Система авторизации и аутентификации: OAuth 2.0 для доступа к Google API
- VPS на Ubuntu 24.04
- Веб-сервер: nginx (reverse proxy)

### Требования к функциональности

#### REST API endpoints:

- `/projects/create` (POST)
  - Создание нового проекта с автоматической настройкой Google Sheets и доступов.

- `/projects/{project_id}/specialists`
  - POST: Добавить специалиста.
  - PUT: Обновить данные специалиста (ставка, дата подключения/отключения).
  - DELETE: Отключить специалиста от проекта.

- `/timesheets`:
  - POST: Генерация таймшита для специалиста по шаблону.

- `/reports`:
  - POST: Генерация сводного отчета по затратам.

- `/periods`:
  - POST: Создание нового периода оплаты.
  - PUT: Закрытие периода оплаты и генерация итогов.

### Модели данных:
- **Специалист:**
  - id (UUID)
  - full_name
  - role
  - email
  - rate_per_hour
  - start_date
  - end_date (опционально)

- **Проект:**
  - id (UUID)
  - name
  - description
  - google_folder_id (папка Google Drive)

- **Период оплаты:**
  - id (UUID)
  - project_id
  - period_name
  - start_date
  - end_date

### Архитектурные особенности:
- Вся информация хранится исключительно в Google Sheets (не используется отдельная база данных).
- Google Sheets используется как единый источник данных (Single Source of Truth).
- Бэкенд обрабатывает запросы фронтенда и напрямую работает с Google Sheets API.

### Требования по развертыванию:
- FastAPI развернут через uvicorn, запуск осуществляется с использованием systemd.
- Доступ по HTTPS с использованием nginx в качестве reverse proxy.
- Предусмотреть отдельный конфигурационный файл (.env) для переменных среды (ключи API, ссылки на шаблоны).

### Ограничения и допущения:
- На данном этапе не предусматривается уведомления специалистов.
- Отсутствует отдельная БД, все данные хранятся в Google Sheets.
- Фронтенд реализуется отдельно (Next.js приложение).

### Критерии приемки:
- Создание, обновление и удаление специалистов через API корректно отображается в Google Sheets.
- Таймшиты создаются и корректно наполняются формулами на основании заданного шаблона.
- Периоды оплаты формируются корректно и рассчитывают актуальные суммы.
- Внесение изменений (ставок, ролей, даты подключения) немедленно отражается во всех связанных Google Sheets.
- Доступы для специалистов корректно выставляются автоматически.

### Порядок сдачи работ:
- Код размещается в приватном репозитории Git.
- Разработка ведется с использованием Gitflow.
- API должен быть документирован с помощью OpenAPI (автоматически средствами FastAPI).

---

